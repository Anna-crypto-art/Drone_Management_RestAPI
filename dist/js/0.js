(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[0],{244:function(e,t,n){"use strict";var i=n(46),a=n(34),r=n(20),s=n(184),o="toString",l=RegExp.prototype,u=l[o],c=r((function(){return"/a/b"!=u.call({source:"a",flags:"b"})})),p=u.name!=o;(c||p)&&i(RegExp.prototype,o,(function(){var e=a(this),t=String(e.source),n=e.flags,i=String(void 0===n&&e instanceof RegExp&&!("flags"in l)?s.call(e):n);return"/"+t+"/"+i}),{unsafe:!0})},245:function(e,t,n){},246:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-button",{class:e.cls,attrs:{variant:e.variant,type:e.type,disabled:e.isDisabled},on:{click:e.onClick}},[n("span",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"app-button-loading"},[n("b-spinner",{attrs:{small:""}})],1),e._t("default")],2)},a=[];i._withStripped=!0;var r=n(22),s=n(23),o=n(31),l=n(30),u=n(40),c=(n(62),n(26),n(16)),p=n(32),f=function(e,t,n,i){var a,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"===typeof Reflect?"undefined":Object(u["a"])(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(r<3?a(s):r>3?a(t,n,s):a(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},d=function(e){Object(o["a"])(n,e);var t=Object(l["a"])(n);function n(){return Object(r["a"])(this,n),t.apply(this,arguments)}return Object(s["a"])(n,[{key:"isDisabled",get:function(){return this.loading||this.disabled}},{key:"onClick",value:function(e){this.$emit("click",e)}}]),n}(c["default"]);f([Object(p["b"])({default:"button"})],d.prototype,"type",void 0),f([Object(p["b"])({default:""})],d.prototype,"cls",void 0),f([Object(p["b"])({default:"primary"})],d.prototype,"variant",void 0),f([Object(p["b"])({default:!1})],d.prototype,"disabled",void 0),f([Object(p["b"])({default:!1})],d.prototype,"loading",void 0),d=f([Object(p["a"])({name:"app-button"})],d);var h=d,m=h,v=(n(247),n(39)),g=Object(v["a"])(m,i,a,!1,null,null,null);g.options.__file="src/app/shared/components/app-button/app-button.vue";t["a"]=g.exports},247:function(e,t,n){"use strict";n(245)},253:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n(26),n(270),n(62);var i=n(99);function a(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(e=Object(i["a"])(e),null===e)break;return e}function r(){return r="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=a(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},r.apply(this,arguments)}},259:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"app-explanation"},[n("span",{ref:"appExplTarget",staticClass:"app-explanation-container"},[n("b-icon",{attrs:{icon:"question-circle-fill"}})],1),n("b-popover",{attrs:{target:function(){return e.$refs.appExplTarget},triggers:"hover",placement:"top"}},[e._t("default")],2)],1)},a=[];i._withStripped=!0;var r=n(23),s=n(22),o=n(31),l=n(30),u=n(40),c=(n(62),n(26),n(16)),p=n(32),f=function(e,t,n,i){var a,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"===typeof Reflect?"undefined":Object(u["a"])(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(r<3?a(s):r>3?a(t,n,s):a(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},d=function(e){Object(o["a"])(n,e);var t=Object(l["a"])(n);function n(){return Object(s["a"])(this,n),t.apply(this,arguments)}return Object(r["a"])(n)}(c["default"]);d=f([Object(p["a"])({name:"app-explanation"})],d);var h=d,m=h,v=(n(271),n(39)),g=Object(v["a"])(m,i,a,!1,null,null,null);g.options.__file="src/app/shared/components/app-explanation/app-explanation.vue";t["a"]=g.exports},261:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return s}));var i,a,r=n(131);(function(e){e[e["UPLOADING"]=1]="UPLOADING",e[e["UPLOAD_FAILED"]=2]="UPLOAD_FAILED",e[e["DATA_INCOMPLETE"]=3]="DATA_INCOMPLETE",e[e["DATA_COMPLETE"]=4]="DATA_COMPLETE",e[e["DATA_COMPLETE_VERIFIED"]=5]="DATA_COMPLETE_VERIFIED",e[e["PROCESSING"]=6]="PROCESSING",e[e["FINISHED"]=7]="FINISHED"})(a||(a={}));var s=(i={},Object(r["a"])(i,a.UPLOADING,"UPLOADING"),Object(r["a"])(i,a.UPLOAD_FAILED,"UPLOAD_FAILED"),Object(r["a"])(i,a.DATA_INCOMPLETE,"DATA_INCOMPLETE"),Object(r["a"])(i,a.DATA_COMPLETE,"DATA_COMPLETE"),Object(r["a"])(i,a.DATA_COMPLETE_VERIFIED,"DATA_COMPLETE_VERIFIED"),Object(r["a"])(i,a.PROCESSING,"PROCESSING"),Object(r["a"])(i,a.FINISHED,"FINISHED"),i)},262:function(e,t,n){"use strict";var i;n.d(t,"a",(function(){return i})),function(e){e["UPDATE_ANALYSIS"]="updateAnalysis",e["RUN_ANALYSIS_TASK"]="runAnalysisTask",e["FINISHED_ANALYSIS_TASK"]="finishedAnalysisTask"}(i||(i={}))},264:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(22),a=n(23),r=n(65),s=n(31),o=n(30),l=(n(98),n(16)),u=function(e){Object(s["a"])(n,e);var t=Object(o["a"])(n);function n(){return Object(i["a"])(this,n),t.apply(this,arguments)}return Object(a["a"])(n,[{key:"emit",value:function(e,t){this.$emit.apply(this,[e].concat(Object(r["a"])(t)))}},{key:"on",value:function(e,t){this.$on(e,t)}}]),n}(l["default"]),c=function(){function e(){Object(i["a"])(this,e)}return Object(a["a"])(e,null,[{key:"getAnalysisEventBus",value:function(t){return t in e.anaylsisEventBusses||(e.anaylsisEventBusses[t]=new u),e.anaylsisEventBusses[t]}},{key:"on",value:function(t,n,i){e.getAnalysisEventBus(t).on(n,i)}},{key:"emit",value:function(t,n){for(var i=arguments.length,a=new Array(i>2?i-2:0),r=2;r<i;r++)a[r-2]=arguments[r];e.getAnalysisEventBus(t).emit(n,a)}}]),e}();c.anaylsisEventBusses={}},268:function(e,t,n){},270:function(e,t,n){var i=n(18),a=n(29),r=n(34),s=n(35),o=n(57),l=n(102);function u(e,t){var n,i,c=arguments.length<3?e:arguments[2];return r(e)===c?e[t]:(n=o.f(e,t))?s(n,"value")?n.value:void 0===n.get?void 0:n.get.call(c):a(i=l(e))?u(i,t,c):void 0}i({target:"Reflect",stat:!0},{get:u})},271:function(e,t,n){"use strict";n(268)},274:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-analysis-upload"},[n("b-form-checkbox",{directives:[{name:"show",rawName:"v-show",value:e.analysis,expression:"analysis"}],attrs:{disabled:!e.hasPlantMetadata},on:{change:e.onChangeDataComplete},model:{value:e.dataComplete,callback:function(t){e.dataComplete=t},expression:"dataComplete"}},[e._v(" "+e._s(e.$t("data-complete"))+" "),n("app-explanation",[e._v(e._s(e.dataCompleteMetadataExpl))])],1),e.uploadService?n("b-form",{staticStyle:{margin:"30px 0"},on:{submit:function(t){return t.preventDefault(),e.onSubmit(t)}}},[e._t("uploadForm"),n("app-file-upload",{ref:"appFileUpload",attrs:{uploadService:e.uploadService,title:e.$t("select-files")}}),n("app-button",{attrs:{type:"submit",loading:e.uploadButtonLoading,disabled:e.uploadButtonDisabled,cls:"pull-right"}},[e._v(e._s(e.uploadButtonTxt))]),n("app-button",{directives:[{name:"show",rawName:"v-show",value:e.showCancelButton,expression:"showCancelButton"}],attrs:{variant:"secondary",loading:e.cancelButtonLoading,type:"button"},on:{click:e.onCancelUpload}},[e._t("cancelButton",[e._v(" "+e._s(e.$t("cancel"))+" ")])],2),n("div",{staticClass:"clearfix"})],2):e._e()],1)},a=[];i._withStripped=!0;var r=n(15),s=n(22),o=n(23),l=n(253),u=n(99),c=n(31),p=n(30),f=n(40),d=(n(63),n(62),n(26),n(244),n(98),n(132),n(185),n(127),n(97),n(32)),h=n(76),m=n(80),v=n(64),g=n(75),b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-file-upload"},[n("div",{staticClass:"app-file-upload-dropzone",attrs:{id:"file-upload-dropzone-id"}},[n("div",{staticClass:"app-file-upload-dropzone-content"},[e.title?n("h3",{staticClass:"app-file-upload-dropzone-content-title"},[e._v(e._s(e.title))]):e._e(),e._t("default")],2),n("div",{staticClass:"app-file-upload-dropzone-browsebutton"},[n("b-button",{attrs:{variant:"primary",id:"file-upload-browsebutton-id"}},[e._v(e._s(e.$t("browse...")))])],1),n("div",{directives:[{name:"show",rawName:"v-show",value:e.keyResumFiles>0,expression:"keyResumFiles > 0"}],key:e.keyResumFiles,staticClass:"app-file-upload-dropzone-files",staticStyle:{"margin-top":"30px"}},e._l(e.files,(function(t){return n("app-file-upload-file",{key:t.uniqueIdentifier,ref:"uploadFiles",refInFor:!0,attrs:{uploadService:e.uploadService,uploading:e.uploading,file:t}})})),1)])])},y=[];b._withStripped=!0;var O=n(16),k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-file-upload-file"},[n("div",{staticClass:"app-file-upload-file-infos"},[n("div",{staticClass:"app-file-upload-file-name"},[n("small",{staticClass:"app-file-upload-file-name-size grayed"},[e._v(e._s(e.getFileSize(e.file.size)))]),e._v(" "+e._s(e.file.fileName)+" "),n("span",{directives:[{name:"show",rawName:"v-show",value:e.error,expression:"error"}],staticClass:"app-file-upload-file-name-error",class:{"text-danger":!e.retry}},[e._v(" "+e._s(e.retry&&e.$t("retrying...")||e.error)+" ")])]),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.uploading,expression:"!uploading"}],staticClass:"app-file-upload-file-remove",on:{click:e.onFileRemove}},[n("b-icon",{attrs:{icon:"x"}})],1),n("div",{directives:[{name:"show",rawName:"v-show",value:e.uploading,expression:"uploading"}],staticClass:"app-file-upload-file-progress"},[n("span",{directives:[{name:"show",rawName:"v-show",value:!e.success,expression:"!success"}]},[e._v(e._s(e.progress)+"%")]),n("b-icon",{directives:[{name:"show",rawName:"v-show",value:e.success,expression:"success"}],staticClass:"text-success",attrs:{icon:"check2"}})],1)]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.uploading,expression:"uploading"}],ref:"uploadProgressBar",staticClass:"app-file-upload-file-progressbar"})])},E=[];k._withStripped=!0;var S=n(49),F=n(277),I=function(e,t,n,i){var a,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"===typeof Reflect?"undefined":Object(f["a"])(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(r<3?a(s):r>3?a(t,n,s):a(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},w=function(e){Object(c["a"])(n,e);var t=Object(p["a"])(n);function n(){var e;return Object(s["a"])(this,n),e=t.apply(this,arguments),e.progress=0,e.error="",e.retry=!1,e.success=!1,e}return Object(o["a"])(n,[{key:"created",value:function(){this.uploading&&(this.emitProgress(),100===this.progress&&this.emitSuccess())}},{key:"uniqueIdentifier",get:function(){return this.file.uniqueIdentifier}},{key:"getFileSize",value:function(e){return Object(F["a"])(e)}},{key:"onFileRemove",value:function(){this.file.cancel(),this.uploadService.emitFileRemoved(this.file)}},{key:"emitError",value:function(e){try{var t=JSON.parse(e);t.error&&(this.error=t.error)}catch(n){console.error(e),this.error=S["a"].SOMETHING_WENT_WRONG}this.success=!1,this.retry=!1}},{key:"emitRetry",value:function(){this.success=!1,this.retry=!0}},{key:"emitProgress",value:function(){var e=Math.round(100*this.file.progress(!1));e!==this.progress&&(this.progress=e,this.error="",this.retry=!1,this.uploadProgressBar&&(this.uploadProgressBar.style.width=this.progress+"%"))}},{key:"emitSuccess",value:function(){this.error="",this.retry=!1,this.progress=0,this.success=!0,this.uploadProgressBar&&(this.uploadProgressBar.style.display="none")}}]),n}(O["default"]);I([Object(d["b"])({required:!0})],w.prototype,"file",void 0),I([Object(d["b"])({required:!0})],w.prototype,"uploading",void 0),I([Object(d["b"])({required:!0})],w.prototype,"uploadService",void 0),I([Object(d["c"])()],w.prototype,"uploadProgressBar",void 0),w=I([Object(d["a"])({name:"app-file-upload-file"})],w);var C=w,R=C,j=(n(311),n(39)),P=Object(j["a"])(R,k,E,!1,null,null,null);P.options.__file="src/app/shared/components/app-file-upload/app-file-upload-file.vue";var x,A,D=P.exports;(function(e){e["UNPREPARED"]="UNPREPARED",e["INITIALIZED"]="INITIALIZED",e["UPLOADING"]="UPLOADING",e["FINISHED"]="FINISHED",e["FAILED"]="FAILED",e["RETRYING"]="RETRYING"})(x||(x={})),function(e){e["FILE_SUCCESS"]="fileSuccess",e["FILE_PROGRESS"]="fileProgress",e["FILE_ERROR"]="fileError",e["FILE_RETRY"]="fileRetry",e["FILE_ADDED"]="fileAdded",e["FILE_REMOVED"]="fileRemoved",e["PROGRESS"]="progress",e["FAILED"]="failed",e["COMPLETED"]="completed"}(A||(A={}));var N=function(e,t,n,i){var a,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"===typeof Reflect?"undefined":Object(f["a"])(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(r<3?a(s):r>3?a(t,n,s):a(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},_=function(e){Object(c["a"])(n,e);var t=Object(p["a"])(n);function n(){var e;return Object(s["a"])(this,n),e=t.apply(this,arguments),e.keyResumFiles=0,e.uploading=!1,e}return Object(o["a"])(n,[{key:"mounted",value:function(){this.checkUploadState(),this.registerUploadEvents()}},{key:"checkUploadState",value:function(){this.uploadService.hasState(x.UPLOADING)?(this.uploading=!0,this.keyResumFiles=this.uploadService.files.length):this.uploadService.init("file-upload-dropzone-id","file-upload-browsebutton-id")}},{key:"registerUploadEvents",value:function(){var e=this;this.uploadService.on(A.FILE_SUCCESS,(function(t){var n=e.getFileUploadFile(t);n&&n.emitSuccess()})),this.uploadService.on(A.FILE_ERROR,(function(t,n){var i=e.getFileUploadFile(t);i&&i.emitError(n)})),this.uploadService.on(A.FILE_PROGRESS,(function(t){var n=e.getFileUploadFile(t);n&&n.emitProgress()})),this.uploadService.on(A.FILE_RETRY,(function(t,n){var i=e.getFileUploadFile(t);i&&i.emitRetry()})),this.uploadService.on(A.FILE_ADDED,(function(t){e.keyResumFiles+=1})),this.uploadService.on(A.FILE_REMOVED,(function(t){e.keyResumFiles-=1}))}},{key:"upload",value:function(e,t){this.uploading=!0,this.keyResumFiles+=100,this.uploadService.upload(e,t)}},{key:"files",get:function(){return this.uploadService.files}},{key:"cancel",value:function(){this.uploadService.cancel(),this.uploading=!1,this.keyResumFiles-=100}},{key:"getFileUploadFile",value:function(e){return this.uploadFiles.find((function(t){return t.uniqueIdentifier===e.uniqueIdentifier}))}}]),n}(O["default"]);N([Object(d["c"])()],_.prototype,"uploadFiles",void 0),N([Object(d["b"])({required:!0})],_.prototype,"uploadService",void 0),N([Object(d["b"])()],_.prototype,"title",void 0),_=N([Object(d["a"])({name:"app-file-upload",components:{AppFileUploadFile:D}})],_);var L=_,T=L,B=(n(312),Object(j["a"])(T,b,y,!1,null,null,null));B.options.__file="src/app/shared/components/app-file-upload/app-file-upload.vue";var U=B.exports,z=n(246),M=n(261),$=n(313),q=n.n($),G=n(28),H=n(65),K=function(e){Object(c["a"])(n,e);var t=Object(p["a"])(n);function n(){return Object(s["a"])(this,n),t.apply(this,arguments)}return Object(o["a"])(n,[{key:"emit",value:function(e,t){this.$emit.apply(this,[e].concat(Object(H["a"])(t)))}},{key:"on",value:function(e,t){this.$on(e,t)}}]),n}(O["default"]),Y=function(){function e(t){Object(s["a"])(this,e),this.maxRetries=5,this.chunkRetryInterval=3e3,this.failedTimeoutInterval=4e3,this.state=x.UNPREPARED,this.retries=0,this.currentProgress=0,this.eventsRegistered=!1,this.resumable=new q.a({chunkSize:10485760,chunkRetryInterval:this.chunkRetryInterval,simultaneousUploads:1,maxChunkRetries:this.maxRetries}),this.id=t,this.uploadEventBus=new K}return Object(o["a"])(e,[{key:"init",value:function(e,t){this.checkState([x.UNPREPARED,x.INITIALIZED,x.FINISHED]),this.initValues(),this.registerEvents();var n=document.getElementById(e);if(!n)throw new Error("No HTML-Element found with id='".concat(e,"'"));if(this.resumable.assignDrop(n),t){var i=document.getElementById(t);if(!i)throw new Error("No HTML-Element found with id='".concat(t,"'"));this.resumable.assignBrowse(i,!1)}this.state=x.INITIALIZED}},{key:"reset",value:function(){this.checkState([x.FINISHED]),this.initValues(),this.state=x.INITIALIZED}},{key:"hasState",value:function(e){return this.state===e}},{key:"files",get:function(){return this.resumable.files}},{key:"cancel",value:function(){this.checkState([x.FAILED,x.UPLOADING,x.INITIALIZED]),this.resumable.cancel(),this.state=x.FINISHED,this.reset()}},{key:"progress",value:function(){return this.currentProgress}},{key:"upload",value:function(e,t){this.checkState([x.INITIALIZED,x.FAILED]),this.state=x.UPLOADING,this.metadata=t,this.resumable.opts.target=e,this.resumable.upload()}},{key:"getMetadata",value:function(){return this.metadata}},{key:"on",value:function(e,t){this.uploadEventBus.on(e,t)}},{key:"emitFileRemoved",value:function(e){this.emit(A.FILE_REMOVED,e)}},{key:"getMaxRetries",value:function(){return this.files.filter((function(e){return!e.isComplete()})).length*this.maxRetries}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.uploadEventBus.emit(e,n)}},{key:"initValues",value:function(){this.resumable.opts.headers={Authorization:"Bearer ".concat(G["a"].state.auth.token)},this.metadata=void 0,this.currentProgress=0}},{key:"checkState",value:function(e){if(Array.isArray(e)||(e=[e]),-1===e.indexOf(this.state))throw new Error("Invalid operation. Resumable is in state: "+this.state)}},{key:"onProgress",value:function(){var e=this.resumable.progress();this.currentProgress===e||this.hasState(x.FINISHED)||(this.currentProgress=e,this.state=x.UPLOADING,this.emit(A.PROGRESS))}},{key:"onRetry",value:function(e){this.failedTimeout&&(clearTimeout(this.failedTimeout),this.failedTimeout=void 0),this.state=x.RETRYING,this.emit(A.FILE_RETRY,e,++this.retries)}},{key:"onFailed",value:function(e){this.state=x.FAILED,this.emit(A.FAILED,e)}},{key:"onCompleted",value:function(){this.failedTimeout||this.hasState(x.FAILED)||(this.state=x.FINISHED,this.resumable.cancel(),this.emit(A.COMPLETED,this.metadata),this.reset())}},{key:"onFileSuccess",value:function(e){this.emit(A.FILE_SUCCESS,e)}},{key:"onFileProgress",value:function(e){this.emit(A.FILE_PROGRESS,e)}},{key:"onFileError",value:function(e,t){var n=this;this.failedTimeout=setTimeout((function(){n.onFailed(t)}),this.failedTimeoutInterval),this.emit(A.FILE_ERROR,e,t)}},{key:"onFileAdded",value:function(e){this.emit(A.FILE_ADDED,e)}},{key:"registerEvents",value:function(){var e=this;this.eventsRegistered||(this.resumable.on("fileSuccess",(function(t){e.onFileSuccess(t)})),this.resumable.on("fileProgress",(function(t){e.onFileProgress(t)})),this.resumable.on("fileError",(function(t,n){e.onFileError(t,n)})),this.resumable.on("fileRetry",(function(t){e.onRetry(t)})),this.resumable.on("fileAdded",(function(t){e.onFileAdded(t)})),this.resumable.on("progress",(function(){e.onProgress()})),this.resumable.on("complete",(function(){e.onCompleted()})),this.resumable.on("error",(function(t){e.onFailed(t)})),this.eventsRegistered=!0)}}],[{key:"findOrCreate",value:function(t){return void 0===t&&(t="0"),t in e.instances||(this.instances[t]=new e(t)),this.instances[t]}}]),e}();Y.instances={};var V=n(280),Z=n(107),J=n(259),W=n(264),X=n(262),Q=function(e,t,n,i){var a,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"===("undefined"===typeof Reflect?"undefined":Object(f["a"])(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(r<3?a(s):r>3?a(t,n,s):a(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},ee=function(e){Object(c["a"])(n,e);var t=Object(p["a"])(n);function n(){var e;return Object(s["a"])(this,n),e=t.apply(this,arguments),e.storageKey="",e.dataComplete=!1,e.waitForFiles=null,e.uploadService=null,e.uploadButtonDisabled=!1,e.uploadButtonLoading=!1,e.uploadButtonTxt="",e.showCancelButton=!1,e.cancelButtonLoading=!1,e}return Object(o["a"])(n,[{key:"mounted",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.uploadService=Y.findOrCreate(null===(t=this.analysis)||void 0===t?void 0:t.id),this.setStorageKey(this.analysis),this.dataComplete=!!this.analysis&&this.analysis.data_complete,this.registerUploadEvents();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"created",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["a"])(Object(u["a"])(n.prototype),"created",this).call(this);case 2:this.uploadButtonTxt=this.$t("upload").toString(),t=this.fetchData(),t&&(this.waitForFiles=t.fileNames);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onAnalysisChanged",value:function(){this.dataComplete=!!this.analysis&&this.analysis.data_complete}},{key:"updated",value:function(){this.checkUploadState()}},{key:"registerUploadEvents",value:function(){var e=this;this.uploadService.on(A.COMPLETED,function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(n){var i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,g["a"].getAnalysis(e.analysis.id);case 3:return i=t.sent,a=i.data_complete,e.waitForFiles=null,t.next=8,g["a"].updateAnalysisState(n.id,{state_id:a?M["a"].DATA_COMPLETE:M["a"].DATA_INCOMPLETE,do_send_mail:!0});case 8:W["a"].emit(i.id,X["a"].UPDATE_ANALYSIS),Z["a"].removeItem(e.storageKey),v["a"].showSuccessAlert(e.$t("upload-completed-successfully").toString()),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](0),v["a"].showError(t.t0);case 16:e.isCreated&&(e.uploadButtonLoading=!1,e.uploadButtonDisabled=!1,e.uploadButtonTxt=e.$t("upload").toString(),e.showCancelButton=!1);case 17:case"end":return t.stop()}}),t,null,[[0,13]])})));return function(e){return t.apply(this,arguments)}}()),this.uploadService.on(A.FAILED,function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return v["a"].showErrorAlert(e.$t(M["b"][M["a"].UPLOAD_FAILED]).toString()),console.error(n),t.prev=2,t.next=5,g["a"].updateAnalysisState(e.uploadService.getMetadata().id,{state_id:M["a"].UPLOAD_FAILED,message:n});case 5:t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](2),console.error(t.t0);case 10:e.isCreated&&e.onFailed();case 11:case"end":return t.stop()}}),t,null,[[2,7]])})));return function(e){return t.apply(this,arguments)}}()),this.uploadService.on(A.FILE_RETRY,(function(t,n){v["a"].showWarningAlert("".concat(e.$t("upload-error-retry").toString()," ").concat(n,"/").concat(e.uploadService.getMaxRetries()),"resumable-upload-error-retry")})),this.uploadService.on(A.FILE_ADDED,(function(t){e.isCreated&&e.checkFileCompleteness()})),this.uploadService.on(A.FILE_REMOVED,(function(t){e.isCreated&&e.checkFileCompleteness()}))}},{key:"checkUploadState",value:function(){this.uploadService.hasState(x.UPLOADING)?this.uploadButtonLoading=!0:this.waitForFiles&&this.waitForFiles.length>0&&(v["a"].showInfoAlert(this.$t("need-files-to-upload_descr").toString()+'<ul style="margin: 5px 0 0 40px;"><li>'+this.waitForFiles.join("</li><li>")+"</li></ul>"),this.uploadButtonTxt=this.$t("resume-upload").toString(),this.uploadButtonDisabled=!0,this.showCancelButton=!0)}},{key:"checkFileCompleteness",value:function(){var e=this;this.waitForFiles&&(this.waitForFiles=this.waitForFiles.filter((function(t){return!e.appFileUpload.files.find((function(e){return e.fileName===t}))})),0===this.waitForFiles.length&&(this.waitForFiles=null,v["a"].clearAlert(),this.uploadButtonDisabled=!1))}},{key:"fetchData",value:function(){return Z["a"].getItem(this.storageKey)}},{key:"storeData",value:function(){var e=this.getStorageData();e?Z["a"].setItem(this.storageKey,e):Z["a"].removeItem(this.storageKey)}},{key:"getStorageData",value:function(){return{fileNames:this.appFileUpload.files.map((function(e){return e.fileName}))}}},{key:"hasPlantMetadata",get:function(){return this.analysis&&this.analysis.has_plant_metadata||!1}},{key:"dataCompleteMetadataExpl",get:function(){return!this.hasPlantMetadata&&this.$t("missing-plant-metadata").toString()||this.$t("data-complete_expl").toString()}},{key:"onSubmit",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,n,i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.uploadService.hasState(x.FAILED)){e.next=7;break}return e.next=3,g["a"].isLoggedIn();case 3:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:return this.$emit("retryUpload"),e.abrupt("return");case 7:return e.prev=7,t=this.uploadButtonTxt===this.$t("resume-upload").toString(),this.onUploading(),e.next=12,new Promise((function(e){i.$emit("startUpload",i.appFileUpload.files.map((function(e){return e.fileName})),t,(function(t){e(t)}))}));case 12:if(n=e.sent,n){e.next=16;break}return this.uploadButtonLoading=!1,e.abrupt("return");case 16:this.setStorageKey(n),this.storeData(),this.appFileUpload.upload(g["a"].getAnalysisFileUploadUrl(n.id),{id:n.id}),e.next=24;break;case 21:e.prev=21,e.t0=e["catch"](7),v["a"].showError(e.t0);case 24:case"end":return e.stop()}}),e,this,[[7,21]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"onFailed",value:function(){this.uploadButtonLoading=!1,this.uploadButtonTxt=this.$t("retry-upload").toString(),this.showCancelButton=!0}},{key:"onUploading",value:function(){this.uploadButtonLoading=!0,this.showCancelButton=!1}},{key:"onCancelUpload",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.cancelButtonLoading=!0,e.prev=1,e.next=4,new Promise((function(e){n.$emit("cancelUpload",(function(t){return e(t)}))}));case 4:t=e.sent,t||(this.appFileUpload.cancel(),Z["a"].removeItem(this.storageKey),this.uploadButtonLoading=!1,this.uploadButtonDisabled=!1,this.uploadButtonTxt=this.$t("upload").toString(),v["a"].clearAlert(),this.showCancelButton=!1);case 6:return e.prev=6,this.cancelButtonLoading=!1,e.finish(6);case 9:case"end":return e.stop()}}),e,this,[[1,,6,9]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"onChangeDataComplete",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,this.analysis.plant.in_setup_phase||!this.dataComplete){e.next=5;break}if(confirm(this.$t("data-complete-sure-quest").toString())){e.next=5;break}return this.dataComplete=!1,e.abrupt("return");case 5:return e.next=7,g["a"].updateAnalysis(this.analysis.id,{data_complete:this.dataComplete});case 7:W["a"].emit(this.analysis.id,X["a"].UPDATE_ANALYSIS),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),v["a"].showError(e.t0);case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"setStorageKey",value:function(e){this.storageKey=V["a"]+(e&&"-"+e.id||"")}}]),n}(h["a"]);Q([Object(d["c"])()],ee.prototype,"appFileUpload",void 0),Q([Object(d["b"])({default:null})],ee.prototype,"analysis",void 0),Q([Object(d["d"])("analysis")],ee.prototype,"onAnalysisChanged",null),ee=Q([Object(d["a"])({name:"app-analysis-upload",components:{AppContent:m["a"],AppFileUpload:U,AppButton:z["a"],AppExplanation:J["a"]}})],ee);var te=ee,ne=te,ie=Object(j["a"])(ne,i,a,!1,null,null,null);ie.options.__file="src/app/analysis/shared/analysis-upload.vue";t["a"]=ie.exports},277:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n(98);function i(e){var t=["KB","MB","GB","TB"],n=0;do{e/=1024}while(e>1024&&++n<t.length);return"".concat(Math.round(e)," ").concat(t[n])}},278:function(e,t,n){},279:function(e,t,n){},280:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i="upload-analysis-storage-key"},311:function(e,t,n){"use strict";n(278)},312:function(e,t,n){"use strict";n(279)},313:function(e,t,n){(function(){"use strict";var t=function(e){if(!(this instanceof t))return new t(e);if(this.version=1,this.support="undefined"!==typeof File&&"undefined"!==typeof Blob&&"undefined"!==typeof FileList&&(!!Blob.prototype.webkitSlice||!!Blob.prototype.mozSlice||!!Blob.prototype.slice||!1),!this.support)return!1;var n=this;n.files=[],n.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,fileParameterName:"file",chunkNumberParameterName:"resumableChunkNumber",chunkSizeParameterName:"resumableChunkSize",currentChunkSizeParameterName:"resumableCurrentChunkSize",totalSizeParameterName:"resumableTotalSize",typeParameterName:"resumableType",identifierParameterName:"resumableIdentifier",fileNameParameterName:"resumableFilename",relativePathParameterName:"resumableRelativePath",totalChunksParameterName:"resumableTotalChunks",throttleProgressCallbacks:.5,query:{},headers:{},preprocess:null,method:"multipart",uploadMethod:"POST",testMethod:"GET",prioritizeFirstAndLastChunk:!1,target:"/",testTarget:null,parameterNamespace:"",testChunks:!0,generateUniqueIdentifier:null,getTarget:null,maxChunkRetries:100,chunkRetryInterval:void 0,permanentErrors:[400,404,415,500,501],maxFiles:void 0,withCredentials:!1,xhrTimeout:0,clearInput:!0,chunkFormat:"blob",setChunkTypeFromFile:!1,maxFilesErrorCallback:function(e,t){var i=n.getOpt("maxFiles");alert("Please upload no more than "+i+" file"+(1===i?"":"s")+" at a time.")},minFileSize:1,minFileSizeErrorCallback:function(e,t){alert(e.fileName||e.name+" is too small, please upload files larger than "+i.formatSize(n.getOpt("minFileSize"))+".")},maxFileSize:void 0,maxFileSizeErrorCallback:function(e,t){alert(e.fileName||e.name+" is too large, please upload files less than "+i.formatSize(n.getOpt("maxFileSize"))+".")},fileType:[],fileTypeErrorCallback:function(e,t){alert(e.fileName||e.name+" has type not allowed, please upload files of type "+n.getOpt("fileType")+".")}},n.opts=e||{},n.getOpt=function(e){var n=this;if(e instanceof Array){var a={};return i.each(e,(function(e){a[e]=n.getOpt(e)})),a}if(n instanceof f){if("undefined"!==typeof n.opts[e])return n.opts[e];n=n.fileObj}if(n instanceof p){if("undefined"!==typeof n.opts[e])return n.opts[e];n=n.resumableObj}if(n instanceof t)return"undefined"!==typeof n.opts[e]?n.opts[e]:n.defaults[e]},n.events=[],n.on=function(e,t){n.events.push(e.toLowerCase(),t)},n.fire=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);var i=e[0].toLowerCase();for(t=0;t<=n.events.length;t+=2)n.events[t]==i&&n.events[t+1].apply(n,e.slice(1)),"catchall"==n.events[t]&&n.events[t+1].apply(null,e);"fileerror"==i&&n.fire("error",e[2],e[1]),"fileprogress"==i&&n.fire("progress")};var i={stopEvent:function(e){e.stopPropagation(),e.preventDefault()},each:function(e,t){if("undefined"!==typeof e.length){for(var n=0;n<e.length;n++)if(!1===t(e[n]))return}else for(n in e)if(!1===t(n,e[n]))return},generateUniqueIdentifier:function(e,t){var i=n.getOpt("generateUniqueIdentifier");if("function"===typeof i)return i(e,t);var a=e.webkitRelativePath||e.fileName||e.name,r=e.size;return r+"-"+a.replace(/[^0-9a-zA-Z_-]/gim,"")},contains:function(e,t){var n=!1;return i.each(e,(function(e){return e!=t||(n=!0,!1)})),n},formatSize:function(e){return e<1024?e+" bytes":e<1048576?(e/1024).toFixed(0)+" KB":e<1073741824?(e/1024/1024).toFixed(1)+" MB":(e/1024/1024/1024).toFixed(1)+" GB"},getTarget:function(e,t){var i=n.getOpt("target");if("test"===e&&n.getOpt("testTarget")&&(i="/"===n.getOpt("testTarget")?n.getOpt("target"):n.getOpt("testTarget")),"function"===typeof i)return i(t);var a=i.indexOf("?")<0?"?":"&",r=t.join("&");return i+a+r}},a=function(e){i.stopEvent(e),e.dataTransfer&&e.dataTransfer.items?u(e.dataTransfer.items,e):e.dataTransfer&&e.dataTransfer.files&&u(e.dataTransfer.files,e)},r=function(e){e.preventDefault()};function s(e,t,n,i){var a;return e.isFile?e.file((function(e){e.relativePath=t+e.name,n.push(e),i()})):(e.isDirectory?a=e:e instanceof File&&n.push(e),"function"===typeof e.webkitGetAsEntry&&(a=e.webkitGetAsEntry()),a&&a.isDirectory?l(a,t+a.name+"/",n,i):("function"===typeof e.getAsFile&&(e=e.getAsFile(),e instanceof File&&(e.relativePath=t+e.name,n.push(e))),void i()))}function o(e,t){if(!e||0===e.length)return t();e[0]((function(){o(e.slice(1),t)}))}function l(e,t,n,i){var a=e.createReader();a.readEntries((function(e){if(!e.length)return i();o(e.map((function(e){return s.bind(null,e,t,n)})),i)}))}function u(e,t){if(e.length){n.fire("beforeAdd");var i=[];o(Array.prototype.map.call(e,(function(e){return s.bind(null,e,"",i)})),(function(){i.length&&c(i,t)}))}}var c=function(e,t){var a=0,r=n.getOpt(["maxFiles","minFileSize","maxFileSize","maxFilesErrorCallback","minFileSizeErrorCallback","maxFileSizeErrorCallback","fileType","fileTypeErrorCallback"]);if("undefined"!==typeof r.maxFiles&&r.maxFiles<e.length+n.files.length){if(1!==r.maxFiles||1!==n.files.length||1!==e.length)return r.maxFilesErrorCallback(e,a++),!1;n.removeFile(n.files[0])}var s=[],o=[],l=e.length,u=function(){if(!--l){if(!s.length&&!o.length)return;window.setTimeout((function(){n.fire("filesAdded",s,o)}),0)}};i.each(e,(function(e){var l=e.name;if(r.fileType.length>0){var c=!1;for(var f in r.fileType){var d="."+r.fileType[f];if(-1!==l.toLowerCase().indexOf(d.toLowerCase(),l.length-d.length)){c=!0;break}}if(!c)return r.fileTypeErrorCallback(e,a++),!1}if("undefined"!==typeof r.minFileSize&&e.size<r.minFileSize)return r.minFileSizeErrorCallback(e,a++),!1;if("undefined"!==typeof r.maxFileSize&&e.size>r.maxFileSize)return r.maxFileSizeErrorCallback(e,a++),!1;function h(i){n.getFromUniqueIdentifier(i)?o.push(e):function(){e.uniqueIdentifier=i;var a=new p(n,e,i);n.files.push(a),s.push(a),a.container="undefined"!=typeof t?t.srcElement:null,window.setTimeout((function(){n.fire("fileAdded",a,t)}),0)}(),u()}var m=i.generateUniqueIdentifier(e,t);m&&"function"===typeof m.then?m.then((function(e){h(e)}),(function(){u()})):h(m)}))};function p(e,t,n){var a=this;a.opts={},a.getOpt=e.getOpt,a._prevProgress=0,a.resumableObj=e,a.file=t,a.fileName=t.fileName||t.name,a.size=t.size,a.relativePath=t.relativePath||t.webkitRelativePath||a.fileName,a.uniqueIdentifier=n,a._pause=!1,a.container="";var r=void 0!==n,s=function(e,t){switch(e){case"progress":a.resumableObj.fire("fileProgress",a,t);break;case"error":a.abort(),r=!0,a.chunks=[],a.resumableObj.fire("fileError",a,t);break;case"success":if(r)return;a.resumableObj.fire("fileProgress",a),a.isComplete()&&a.resumableObj.fire("fileSuccess",a,t);break;case"retry":a.resumableObj.fire("fileRetry",a);break}};return a.chunks=[],a.abort=function(){var e=0;i.each(a.chunks,(function(t){"uploading"==t.status()&&(t.abort(),e++)})),e>0&&a.resumableObj.fire("fileProgress",a)},a.cancel=function(){var e=a.chunks;a.chunks=[],i.each(e,(function(e){"uploading"==e.status()&&(e.abort(),a.resumableObj.uploadNextChunk())})),a.resumableObj.removeFile(a),a.resumableObj.fire("fileProgress",a)},a.retry=function(){a.bootstrap();var e=!1;a.resumableObj.on("chunkingComplete",(function(){e||a.resumableObj.upload(),e=!0}))},a.bootstrap=function(){a.abort(),r=!1,a.chunks=[],a._prevProgress=0;for(var e=a.getOpt("forceChunkSize")?Math.ceil:Math.floor,t=Math.max(e(a.file.size/a.getOpt("chunkSize")),1),n=0;n<t;n++)(function(e){window.setTimeout((function(){a.chunks.push(new f(a.resumableObj,a,e,s)),a.resumableObj.fire("chunkingProgress",a,e/t)}),0)})(n);window.setTimeout((function(){a.resumableObj.fire("chunkingComplete",a)}),0)},a.progress=function(){if(r)return 1;var e=0,t=!1;return i.each(a.chunks,(function(n){"error"==n.status()&&(t=!0),e+=n.progress(!0)})),e=t||e>.99999?1:e,e=Math.max(a._prevProgress,e),a._prevProgress=e,e},a.isUploading=function(){var e=!1;return i.each(a.chunks,(function(t){if("uploading"==t.status())return e=!0,!1})),e},a.isComplete=function(){var e=!1;return i.each(a.chunks,(function(t){var n=t.status();if("pending"==n||"uploading"==n||1===t.preprocessState)return e=!0,!1})),!e},a.pause=function(e){a._pause="undefined"===typeof e?!a._pause:e},a.isPaused=function(){return a._pause},a.resumableObj.fire("chunkingStart",a),a.bootstrap(),this}function f(e,t,n,a){var r=this;r.opts={},r.getOpt=e.getOpt,r.resumableObj=e,r.fileObj=t,r.fileObjSize=t.size,r.fileObjType=t.file.type,r.offset=n,r.callback=a,r.lastProgressCallback=new Date,r.tested=!1,r.retries=0,r.pendingRetry=!1,r.preprocessState=0;var s=r.getOpt("chunkSize");return r.loaded=0,r.startByte=r.offset*s,r.endByte=Math.min(r.fileObjSize,(r.offset+1)*s),r.fileObjSize-r.endByte<s&&!r.getOpt("forceChunkSize")&&(r.endByte=r.fileObjSize),r.xhr=null,r.test=function(){r.xhr=new XMLHttpRequest;var e=function(e){r.tested=!0;var t=r.status();"success"==t?(r.callback(t,r.message()),r.resumableObj.uploadNextChunk()):r.send()};r.xhr.addEventListener("load",e,!1),r.xhr.addEventListener("error",e,!1),r.xhr.addEventListener("timeout",e,!1);var t=[],n=r.getOpt("parameterNamespace"),a=r.getOpt("query");"function"==typeof a&&(a=a(r.fileObj,r)),i.each(a,(function(e,i){t.push([encodeURIComponent(n+e),encodeURIComponent(i)].join("="))})),t=t.concat([["chunkNumberParameterName",r.offset+1],["chunkSizeParameterName",r.getOpt("chunkSize")],["currentChunkSizeParameterName",r.endByte-r.startByte],["totalSizeParameterName",r.fileObjSize],["typeParameterName",r.fileObjType],["identifierParameterName",r.fileObj.uniqueIdentifier],["fileNameParameterName",r.fileObj.fileName],["relativePathParameterName",r.fileObj.relativePath],["totalChunksParameterName",r.fileObj.chunks.length]].filter((function(e){return r.getOpt(e[0])})).map((function(e){return[n+r.getOpt(e[0]),encodeURIComponent(e[1])].join("=")}))),r.xhr.open(r.getOpt("testMethod"),i.getTarget("test",t)),r.xhr.timeout=r.getOpt("xhrTimeout"),r.xhr.withCredentials=r.getOpt("withCredentials");var s=r.getOpt("headers");"function"===typeof s&&(s=s(r.fileObj,r)),i.each(s,(function(e,t){r.xhr.setRequestHeader(e,t)})),r.xhr.send(null)},r.preprocessFinished=function(){r.preprocessState=2,r.send()},r.send=function(){var e=r.getOpt("preprocess");if("function"===typeof e)switch(r.preprocessState){case 0:return r.preprocessState=1,void e(r);case 1:return;case 2:break}if(!r.getOpt("testChunks")||r.tested){r.xhr=new XMLHttpRequest,r.xhr.upload.addEventListener("progress",(function(e){new Date-r.lastProgressCallback>1e3*r.getOpt("throttleProgressCallbacks")&&(r.callback("progress"),r.lastProgressCallback=new Date),r.loaded=e.loaded||0}),!1),r.loaded=0,r.pendingRetry=!1,r.callback("progress");var t=function(e){var t=r.status();if("success"==t||"error"==t)r.callback(t,r.message()),r.resumableObj.uploadNextChunk();else{r.callback("retry",r.message()),r.abort(),r.retries++;var n=r.getOpt("chunkRetryInterval");void 0!==n?(r.pendingRetry=!0,setTimeout(r.send,n)):r.send()}};r.xhr.addEventListener("load",t,!1),r.xhr.addEventListener("error",t,!1),r.xhr.addEventListener("timeout",t,!1);var n=[["chunkNumberParameterName",r.offset+1],["chunkSizeParameterName",r.getOpt("chunkSize")],["currentChunkSizeParameterName",r.endByte-r.startByte],["totalSizeParameterName",r.fileObjSize],["typeParameterName",r.fileObjType],["identifierParameterName",r.fileObj.uniqueIdentifier],["fileNameParameterName",r.fileObj.fileName],["relativePathParameterName",r.fileObj.relativePath],["totalChunksParameterName",r.fileObj.chunks.length]].filter((function(e){return r.getOpt(e[0])})).reduce((function(e,t){return e[r.getOpt(t[0])]=t[1],e}),{}),a=r.getOpt("query");"function"==typeof a&&(a=a(r.fileObj,r)),i.each(a,(function(e,t){n[e]=t}));var s=r.fileObj.file.slice?"slice":r.fileObj.file.mozSlice?"mozSlice":r.fileObj.file.webkitSlice?"webkitSlice":"slice",o=r.fileObj.file[s](r.startByte,r.endByte,r.getOpt("setChunkTypeFromFile")?r.fileObj.file.type:""),l=null,u=[],c=r.getOpt("parameterNamespace");if("octet"===r.getOpt("method"))l=o,i.each(n,(function(e,t){u.push([encodeURIComponent(c+e),encodeURIComponent(t)].join("="))}));else if(l=new FormData,i.each(n,(function(e,t){l.append(c+e,t),u.push([encodeURIComponent(c+e),encodeURIComponent(t)].join("="))})),"blob"==r.getOpt("chunkFormat"))l.append(c+r.getOpt("fileParameterName"),o,r.fileObj.fileName);else if("base64"==r.getOpt("chunkFormat")){var p=new FileReader;p.onload=function(e){l.append(c+r.getOpt("fileParameterName"),p.result),r.xhr.send(l)},p.readAsDataURL(o)}var f=i.getTarget("upload",u),d=r.getOpt("uploadMethod");r.xhr.open(d,f),"octet"===r.getOpt("method")&&r.xhr.setRequestHeader("Content-Type","application/octet-stream"),r.xhr.timeout=r.getOpt("xhrTimeout"),r.xhr.withCredentials=r.getOpt("withCredentials");var h=r.getOpt("headers");"function"===typeof h&&(h=h(r.fileObj,r)),i.each(h,(function(e,t){r.xhr.setRequestHeader(e,t)})),"blob"==r.getOpt("chunkFormat")&&r.xhr.send(l)}else r.test()},r.abort=function(){r.xhr&&r.xhr.abort(),r.xhr=null},r.status=function(){return r.pendingRetry?"uploading":r.xhr?r.xhr.readyState<4?"uploading":200==r.xhr.status||201==r.xhr.status?"success":i.contains(r.getOpt("permanentErrors"),r.xhr.status)||r.retries>=r.getOpt("maxChunkRetries")?"error":(r.abort(),"pending"):"pending"},r.message=function(){return r.xhr?r.xhr.responseText:""},r.progress=function(e){"undefined"===typeof e&&(e=!1);var t=e?(r.endByte-r.startByte)/r.fileObjSize:1;if(r.pendingRetry)return 0;r.xhr&&r.xhr.status||(t*=.95);var n=r.status();switch(n){case"success":case"error":return 1*t;case"pending":return 0*t;default:return r.loaded/(r.endByte-r.startByte)*t}},this}return n.uploadNextChunk=function(){var e=!1;if(n.getOpt("prioritizeFirstAndLastChunk")&&(i.each(n.files,(function(t){return t.chunks.length&&"pending"==t.chunks[0].status()&&0===t.chunks[0].preprocessState?(t.chunks[0].send(),e=!0,!1):t.chunks.length>1&&"pending"==t.chunks[t.chunks.length-1].status()&&0===t.chunks[t.chunks.length-1].preprocessState?(t.chunks[t.chunks.length-1].send(),e=!0,!1):void 0})),e))return!0;if(i.each(n.files,(function(t){if(!1===t.isPaused()&&i.each(t.chunks,(function(t){if("pending"==t.status()&&0===t.preprocessState)return t.send(),e=!0,!1})),e)return!1})),e)return!0;var t=!1;return i.each(n.files,(function(e){if(!e.isComplete())return t=!0,!1})),t||n.fire("complete"),!1},n.assignBrowse=function(e,t){"undefined"==typeof e.length&&(e=[e]),i.each(e,(function(e){var i;"INPUT"===e.tagName&&"file"===e.type?i=e:(i=document.createElement("input"),i.setAttribute("type","file"),i.style.display="none",e.addEventListener("click",(function(){i.style.opacity=0,i.style.display="block",i.focus(),i.click(),i.style.display="none"}),!1),e.appendChild(i));var a=n.getOpt("maxFiles");"undefined"===typeof a||1!=a?i.setAttribute("multiple","multiple"):i.removeAttribute("multiple"),t?i.setAttribute("webkitdirectory","webkitdirectory"):i.removeAttribute("webkitdirectory");var r=n.getOpt("fileType");"undefined"!==typeof r&&r.length>=1?i.setAttribute("accept",r.map((function(e){return"."+e})).join(",")):i.removeAttribute("accept"),i.addEventListener("change",(function(e){c(e.target.files,e);var t=n.getOpt("clearInput");t&&(e.target.value="")}),!1)}))},n.assignDrop=function(e){"undefined"==typeof e.length&&(e=[e]),i.each(e,(function(e){e.addEventListener("dragover",r,!1),e.addEventListener("dragenter",r,!1),e.addEventListener("drop",a,!1)}))},n.unAssignDrop=function(e){"undefined"==typeof e.length&&(e=[e]),i.each(e,(function(e){e.removeEventListener("dragover",r),e.removeEventListener("dragenter",r),e.removeEventListener("drop",a)}))},n.isUploading=function(){var e=!1;return i.each(n.files,(function(t){if(t.isUploading())return e=!0,!1})),e},n.upload=function(){if(!n.isUploading()){n.fire("uploadStart");for(var e=1;e<=n.getOpt("simultaneousUploads");e++)n.uploadNextChunk()}},n.pause=function(){i.each(n.files,(function(e){e.abort()})),n.fire("pause")},n.cancel=function(){n.fire("beforeCancel");for(var e=n.files.length-1;e>=0;e--)n.files[e].cancel();n.fire("cancel")},n.progress=function(){var e=0,t=0;return i.each(n.files,(function(n){e+=n.progress()*n.size,t+=n.size})),t>0?e/t:0},n.addFile=function(e,t){c([e],t)},n.addFiles=function(e,t){c(e,t)},n.removeFile=function(e){for(var t=n.files.length-1;t>=0;t--)n.files[t]===e&&n.files.splice(t,1)},n.getFromUniqueIdentifier=function(e){var t=!1;return i.each(n.files,(function(n){n.uniqueIdentifier==e&&(t=n)})),t},n.getSize=function(){var e=0;return i.each(n.files,(function(t){e+=t.size})),e},n.handleDropEvent=function(e){a(e)},n.handleChangeEvent=function(e){c(e.target.files,e),e.target.value=""},n.updateQuery=function(e){n.opts.query=e},this};e.exports=t})()}}]);