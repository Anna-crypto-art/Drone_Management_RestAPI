(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{301:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(18),i=a(19),r=a(284),s=a(117),l=a(23),o=a(22),u=(a(83),a(305)),c=function(e){Object(l["a"])(a,e);var t=Object(o["a"])(a);function a(){return Object(n["a"])(this,a),t.apply(this,arguments)}return Object(i["a"])(a,[{key:"on",value:function(e,t,n){Object(r["a"])(Object(s["a"])(a.prototype),"on",this).call(this,e,t,n)}},{key:"emit",value:function(e,t){for(var n,i=arguments.length,l=new Array(i>2?i-2:0),o=2;o<i;o++)l[o-2]=arguments[o];return(n=Object(r["a"])(Object(s["a"])(a.prototype),"emit",this)).call.apply(n,[this,e,t].concat(l))}}]),a}(u["a"]),p=new c},303:function(e,t,a){"use strict";var n;a.d(t,"a",(function(){return n})),function(e){e["UPDATE_ANALYSIS"]="updateAnalysis",e["RUN_ANALYSIS_TASK"]="runAnalysisTask",e["FINISHED_ANALYSIS_TASK"]="finishedAnalysisTask",e["QFLY_SERVER_STATE_CHANGED"]="qflyServerStateChanged"}(n||(n={}))},333:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));a(83);function n(e){var t=["KB","MB","GB","TB"],a=0;do{e/=1024}while(e>1024&&++a<t.length);return"".concat(Math.round(e)," ").concat(t[a])}},363:function(e,t,a){},364:function(e,t,a){},365:function(e,t,a){},430:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-analysis-upload"},[a("div",{staticClass:"mar-bottom-2x"},[a("b-form-checkbox",{directives:[{name:"show",rawName:"v-show",value:e.analysis&&!e.analysisIsEmpty,expression:"analysis && !analysisIsEmpty"}],attrs:{disabled:e.dataCompleteVerified||!!e.analysisHasAvailableDrones&&!e.analysisHasSelectedDrone},on:{change:e.onChangeDataComplete},model:{value:e.dataComplete,callback:function(t){e.dataComplete=t},expression:"dataComplete"}},[e._v(" "+e._s(e.$t("data-complete"))+" "),a("app-explanation",[e._v(e._s(e.$t("data-complete_expl")))])],1)],1),a("b-alert",{attrs:{show:e.analysis&&e.allowUploadFurtherData&&e.analysisHasAvailableDrones&&!e.analysisHasSelectedDrone,variant:"info"}},[e._v(" "+e._s(e.$t("need-to-select-drone-to-set-complete"))+" ")]),a("b-alert",{attrs:{show:e.analysis&&e.analysisIsEmpty,variant:"info"}},[e._v(" "+e._s(e.$t("need-to-upload-data-to-set-complete"))+" ")]),a("b-alert",{attrs:{show:!e.allowUploadFurtherData,variant:"info"}},[e._v(" "+e._s(e.$t("cannot-upload-further-data-while-data-complete"))+" ")]),e.uploaderService?a("app-uploader",{directives:[{name:"show",rawName:"v-show",value:e.allowUploadFurtherData,expression:"allowUploadFurtherData"}],attrs:{uploaderService:e.uploaderService,title:e.$t("browse-or-drag-drop-files"),disableAfterUpload:!e.analysis}},[e._l(e.$slots,(function(t,n){return a("template",{slot:n},[e._t(n)],2)}))],2):e._e(),e.gotoNewAnalysis?a("div",{staticClass:"pull-right mar-top mar-bottom"},[a("app-button",{on:{click:e.onGotoNewAnalysisClick}},[e._v(e._s(e.$t("goto-analysis",{analysis:e.gotoNewAnalysis.name})))])],1):e._e()],1)},i=[];n._withStripped=!0;var r=a(6),s=a(9),l=a(18),o=a(19),u=a(23),c=a(22),p=a(27),d=(a(44),a(24),a(82),a(62)),f=a(125),h=a(100),v=a(286),b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-file-upload"},[a("b-alert",{attrs:{variant:"danger"},model:{value:e.showErrorAlert,callback:function(t){e.showErrorAlert=t},expression:"showErrorAlert"}},[e.error?a("div",[e._v(" "+e._s(e.$t("error-occured-retrying"))+" "),a("span",{staticClass:"pad-left"},[a("b-spinner",{attrs:{small:""}}),e._v(" ("+e._s(e.errorTrials)+" "+e._s(e.$t("trials"))+") ")],1),e.errorTrials>10?a("div",{staticClass:"mar-top"},[a("app-button",{attrs:{variant:"secondary",size:"sm",loading:e.cancelLoading},on:{click:e.onCancelUploadClick}},[e._v(" "+e._s(e.$t("cancel-upload"))+" ")])],1):e._e(),a("div",{staticClass:"mar-top font-xs"},[e._v(" "+e._s(e.$t("details"))+": "),a("b",[e._v(e._s(e.error.error))]),a("br"),e._v(" "+e._s(e.error.message)+" ")])]):e._e()]),a("app-files-selection",{attrs:{disabled:e.disableFilesSelection},on:{filesSelected:e.onFilesSelected},scopedSlots:e._u([{key:"files",fn:function(){return[a("div",{directives:[{name:"show",rawName:"v-show",value:e.files.length>0,expression:"files.length > 0"}],staticClass:"app-file-upload-files mar-top"},e._l(e.files,(function(t){return a("app-file-uploader",{key:t.fileName,attrs:{uploaderService:e.uploaderService,uploading:e.uploading,file:t}})})),1)]},proxy:!0}])},[a("div",{staticClass:"app-file-upload-content mar-bottom"},[e.title?a("h3",{staticClass:"app-file-upload-content-title"},[e._v(e._s(e.title))]):e._e(),e._t("default")],2)]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showUploadButton,expression:"showUploadButton"}],staticClass:"pull-right mar-top mar-bottom"},[a("app-button",{attrs:{loading:e.uploading,disabled:e.uploadButtonDisabled,cls:"mar-left pull-right"},on:{click:e.onStartUpload}},[e._v(" "+e._s(e.$t("upload"))+" ")]),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.uploading,expression:"!uploading"}],staticClass:"pull-right"},[e._t("addActions")],2)],1)],1)},y=[];b._withStripped=!0;var m=a(15),O=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-file-upload-file mar-bottom-half"},[a("div",{staticClass:"app-file-upload-file-infos"},[a("div",{staticClass:"app-file-upload-file-name"},[a("small",{staticClass:"grayed"},[e._v(e._s(e.fileSize))]),a("span",{staticClass:"pad-left"},[e._v(e._s(e.file.fileName))]),e.file.description?a("span",{staticClass:"pad-left font-xs",domProps:{innerHTML:e._s(e.file.description)}}):e._e()]),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.uploading,expression:"!uploading"}],staticClass:"app-file-upload-file-remove",on:{click:e.onFileRemove}},[a("b-icon",{attrs:{icon:"x"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.uploading,expression:"uploading"}],staticClass:"app-file-upload-file-progress"},[a("span",{directives:[{name:"show",rawName:"v-show",value:!e.success,expression:"!success"}]},[e._v(e._s(e.progress)+"%")]),a("b-icon",{directives:[{name:"show",rawName:"v-show",value:e.success,expression:"success"}],staticClass:"text-success",attrs:{icon:"check2"}})],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.uploading,expression:"uploading"}],ref:"uploadProgressBar",staticClass:"app-file-upload-file-progressbar"})])},g=[];O._withStripped=!0;var k=a(17),w=a(333),_=function(e,t,a,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(p["a"])(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,a,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(s=(r<3?i(s):r>3?i(t,a,s):i(t,a))||s);return r>3&&s&&Object.defineProperty(t,a,s),s},E=function(e){Object(u["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(l["a"])(this,a),e=t.apply(this,arguments),e.progress=0,e.success=!1,e}return Object(o["a"])(a,[{key:"created",value:function(){var e=this;this.file.onProgress((function(t){e.progress=t,e.uploadProgressBar&&(e.uploadProgressBar.style.width=e.progress+"%")})),this.file.onComplete((function(){e.success=!0,e.uploadProgressBar&&(e.uploadProgressBar.style.display="none"),e.progress=0}))}},{key:"fileSize",get:function(){return Object(w["a"])(this.file.size)}},{key:"onFileRemove",value:function(){this.uploading||this.uploaderService.removeFile(this.file.fileName)}}]),a}(k["default"]);_([Object(m["b"])({required:!0})],E.prototype,"file",void 0),_([Object(m["b"])({required:!0})],E.prototype,"uploading",void 0),_([Object(m["b"])({required:!0})],E.prototype,"uploaderService",void 0),_([Object(m["c"])()],E.prototype,"uploadProgressBar",void 0),E=_([Object(m["a"])({name:"app-file-uploader"})],E);var j=E,C=j,S=(a(473),a(28)),A=Object(S["a"])(C,O,g,!1,null,null,null);A.options.__file="src/app/shared/components/app-file-upload/app-file-uploader.vue";var U=A.exports,I=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-file-selection mar-bottom",class:{dragging:e.dragging},on:{drop:e.onDrop,dragover:e.onDragOver,dragleave:e.onDragLeave}},[e._t("default"),a("div",{staticClass:"app-file-selection-button"},[a("app-file-input",{attrs:{disabled:e.disabled},model:{value:e.fileButtonSelection,callback:function(t){e.fileButtonSelection=t},expression:"fileButtonSelection"}})],1),e._t("files")],2)},x=[];I._withStripped=!0;var P=a(49),R=(a(155),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("label",{staticClass:"app-file-input btn btn-primary",class:{disabled:e.disabled}},[a("input",{ref:"fileInputElement",staticClass:"app-file-input-file",attrs:{type:"file",disabled:e.disabled,accept:e.accept,multiple:e.multiple},on:{click:e.onClick,change:e.onChange}}),e._v(" "+e._s(e.$t("browse"))+" ")])}),N=[];R._withStripped=!0;var D=function(e,t,a,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(p["a"])(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,a,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(s=(r<3?i(s):r>3?i(t,a,s):i(t,a))||s);return r>3&&s&&Object.defineProperty(t,a,s),s},L=function(e){Object(u["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(l["a"])(this,a),e=t.apply(this,arguments),e.modelValue=null,e}return Object(o["a"])(a,[{key:"created",value:function(){this.modelValue=this.value}},{key:"onModelValueChanged",value:function(){this.$emit("input",this.modelValue)}},{key:"onClick",value:function(){this.fileInputElement.value=""}},{key:"onChange",value:function(){this.setFiles()}},{key:"setFiles",value:function(){if(this.fileInputElement.files&&0!==this.fileInputElement.files.length){for(var e=[],t=0;t<this.fileInputElement.files.length;t++)e.push(this.fileInputElement.files[t]);this.modelValue=e}else this.modelValue=null}}]),a}(k["default"]);D([Object(m["b"])({required:!0})],L.prototype,"value",void 0),D([Object(m["b"])({default:!0})],L.prototype,"multiple",void 0),D([Object(m["b"])({default:"*"})],L.prototype,"accept",void 0),D([Object(m["b"])({default:!1})],L.prototype,"disabled",void 0),D([Object(m["c"])()],L.prototype,"fileInputElement",void 0),D([Object(m["d"])("modelValue")],L.prototype,"onModelValueChanged",null),L=D([Object(m["a"])({name:"app-file-input"})],L);var F=L,T=F,M=(a(474),Object(S["a"])(T,R,N,!1,null,null,null));M.options.__file="src/app/shared/components/app-file-upload/app-file-input.vue";var B=M.exports,$=function(e,t,a,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(p["a"])(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,a,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(s=(r<3?i(s):r>3?i(t,a,s):i(t,a))||s);return r>3&&s&&Object.defineProperty(t,a,s),s},G=function(e){Object(u["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(l["a"])(this,a),e=t.apply(this,arguments),e.fileButtonSelection=null,e.fileDropSelection=null,e.dragging=!1,e}return Object(o["a"])(a,[{key:"emitFiles",value:function(){this.disabled||this.$emit("filesSelected",this.fileDropSelection||this.fileButtonSelection)}},{key:"onFileButtonSelectionChanged",value:function(){this.fileButtonSelection&&(this.fileDropSelection=null),this.emitFiles()}},{key:"onDrop",value:function(e){e.preventDefault(),this.dragging=!1;var t=[];Object(P["a"])(e.dataTransfer.files).forEach((function(e){t.push(e)})),this.fileButtonSelection=null,t.length>0?this.fileDropSelection=t:this.fileDropSelection=null,this.emitFiles()}},{key:"onDragOver",value:function(e){e.preventDefault(),this.dragging=!0}},{key:"onDragLeave",value:function(){this.dragging=!1}}]),a}(k["default"]);$([Object(m["b"])({default:!1})],G.prototype,"disabled",void 0),$([Object(m["d"])("fileButtonSelection")],G.prototype,"onFileButtonSelectionChanged",null),G=$([Object(m["a"])({name:"app-files-selection",components:{AppFileInput:B}})],G);var z=G,V=z,H=(a(475),Object(S["a"])(V,I,x,!1,null,null,null));H.options.__file="src/app/shared/components/app-file-upload/app-files-selection.vue";var Y,q=H.exports;(function(e){e[e["SELECTING"]=0]="SELECTING",e[e["UPLOADING"]=10]="UPLOADING",e[e["RETRYING"]=11]="RETRYING",e[e["COMPLETED"]=20]="COMPLETED",e[e["CANCELED"]=21]="CANCELED"})(Y||(Y={}));var K=a(97),J=a(45),Q=function(e,t,a,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(p["a"])(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,a,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(s=(r<3?i(s):r>3?i(t,a,s):i(t,a))||s);return r>3&&s&&Object.defineProperty(t,a,s),s},W=function(e){Object(u["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(l["a"])(this,a),e=t.apply(this,arguments),e.uploaderState=Y.SELECTING,e.uploading=!1,e.error=null,e.showErrorAlert=!1,e.showUploadButton=!0,e.cancelLoading=!1,e}return Object(o["a"])(a,[{key:"created",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.registerUploaderEvents();case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"hasStateSelecting",get:function(){return this.uploaderState===Y.SELECTING}},{key:"hasStateUploading",get:function(){return this.uploaderState===Y.UPLOADING}},{key:"hasStateRetrying",get:function(){return this.uploaderState===Y.RETRYING}},{key:"hasStateCompleted",get:function(){return this.uploaderState===Y.COMPLETED}},{key:"hasStateCanceled",get:function(){return this.uploaderState===Y.CANCELED}},{key:"onFilesSelected",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(t){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.uploaderService.fileUploaders=[],!t){e.next=4;break}return e.next=4,this.uploaderService.addFiles(t);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"onStartUpload",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.uploaderService.doUpload();case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onCancelUploadClick",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(confirm(this.$t("sure-to-cancel-upload").toString())){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.uploaderService.cancelUpload();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"files",get:function(){return this.uploaderService.fileUploaders}},{key:"uploadButtonDisabled",get:function(){return 0===this.files.length||this.uploading}},{key:"disableFilesSelection",get:function(){return this.uploading||!this.showUploadButton}},{key:"errorTrials",get:function(){return this.uploaderService.getTrials()}},{key:"registerUploaderEvents",value:function(){var e=this;this.uploaderService.onStartUpload((function(){e.uploaderState=Y.UPLOADING,e.uploading=!0,e.error=null,e.showErrorAlert=!1})),this.uploaderService.onResume((function(){e.uploaderState=Y.UPLOADING,e.error=null,e.showErrorAlert=!1})),this.uploaderService.onError((function(t){e.uploaderState=Y.RETRYING,e.uploading=!0,e.error=t,e.showErrorAlert=!0})),this.uploaderService.onUploadComplete((function(){e.uploaderState=Y.COMPLETED,e.showUploadButton=!e.disableAfterUpload,e.uploading=!1,e.showSuccess(e.$t("upload-completed-successfully").toString(),!1)})),this.uploaderService.onUploadCanceled((function(){e.uploaderState=Y.CANCELED,e.showUploadButton=!e.disableAfterUpload,e.uploading=!1,e.error=null,e.showErrorAlert=!1}))}}]),a}(J["a"]);Q([Object(m["b"])({required:!0})],W.prototype,"uploaderService",void 0),Q([Object(m["b"])()],W.prototype,"title",void 0),Q([Object(m["b"])({default:!1})],W.prototype,"disableAfterUpload",void 0),Q([Object(K["a"])()],W.prototype,"onFilesSelected",null),Q([Object(K["a"])()],W.prototype,"onStartUpload",null),Q([Object(K["a"])("cancelLoading")],W.prototype,"onCancelUploadClick",null),W=Q([Object(m["a"])({name:"app-uploader",components:{AppFileUploader:U,AppFilesSelection:q,AppButton:d["a"]}})],W);var X=W,Z=X,ee=Object(S["a"])(Z,b,y,!1,null,null,null);ee.options.__file="src/app/shared/components/app-file-upload/app-uploader.vue";var te,ae=ee.exports,ne=a(58),ie=a(284),re=a(117),se=(a(118),a(83),a(76),a(85),a(42)),le=(a(96),a(75),a(150),a(220),a(221),a(149),a(313)),oe=a(324);a(46),a(53),a(124);(function(e){e["FILE_PROGRESS"]="UPLOAD_FILE_PROGRESS",e["FILE_COMPLETE"]="FILE_COMPLETE",e["FILE_CHUNK_COMPLETE"]="FILE_CHUNK_COMPLETE",e["ERROR"]="UPLOAD_ERROR",e["START_UPLOAD"]="START_UPLOAD",e["UPLOAD_COMPLETE"]="UPLOAD_COMPLETE",e["UPLOAD_CANCELED"]="UPLOAD_CANCELED",e["RESUME_UPLOAD_AFTER_ERROR"]="RESUME_UPLOAD_AFTER_ERROR"})(te||(te={}));var ue=function(){function e(t,a,n){Object(l["a"])(this,e),this.file=t,this.fileName=a,this.chunkSizeInMB=n,this.event=new le["EventEmitter"],this.complete=!1,this.uploadId=null,this.fileId=null,this.missingChunkNumbers=[],this.description=""}return Object(o["a"])(e,[{key:"onProgress",value:function(e){this.event.on(te.FILE_PROGRESS,e)}},{key:"onChunkComplete",value:function(e){this.event.on(te.FILE_CHUNK_COMPLETE,e)}},{key:"onComplete",value:function(e){this.event.on(te.FILE_COMPLETE,e)}},{key:"onError",value:function(e){this.event.on(te.ERROR,e)}},{key:"emitProgress",value:function(e){this.event.emit(te.FILE_PROGRESS,e)}},{key:"emitComplete",value:function(){this.event.emit(te.FILE_COMPLETE)}},{key:"emitError",value:function(){this.event.emit(te.ERROR)}},{key:"emitChunkComplete",value:function(){this.event.emit(te.FILE_CHUNK_COMPLETE)}},{key:"fileUploadCompleted",value:function(){this.complete=!0,this.emitComplete()}},{key:"size",get:function(){return this.file.size}},{key:"upload",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(){var t,a,n,i,s,l,o=this;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.complete){e.next=3;break}return this.fileUploadCompleted(),e.abrupt("return");case 3:t=1024*this.chunkSizeInMB*1024,a=this.file.size,n=0,i=!1,s=Object(r["a"])().mark((function e(){var s,l,u,c;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s=o.getNextChunkNumber(n),!1!==s){e.next=3;break}return e.abrupt("return","break");case 3:return n=s-1,l=n*t,u=s*t,u>=a&&(i=!0,u=a),c=o.file.slice(l,u),e.next=10,se["a"].uploadFileChunk(o.uploadId,c,o.fileId,n+1,(function(e){var i=t/a*n,r=e.loaded/e.total,s=(u-l)/a,c=Math.round(100*(i+r*s));o.emitProgress(c)}));case 10:o.emitChunkComplete(),o.removeChunkNumber(),n++;case 13:case"end":return e.stop()}}),e)}));case 8:if(i){e.next=15;break}return e.delegateYield(s(),"t0",10);case 10:if(l=e.t0,"break"!==l){e.next=13;break}return e.abrupt("break",15);case 13:e.next=8;break;case 15:this.fileUploadCompleted();case 16:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"unregisterEvents",value:function(){this.event.removeAllListeners()}},{key:"getNextChunkNumber",value:function(e){if(this.missingChunkNumbers.length>0){var t=this.missingChunkNumbers[0];if(-1===t){if(t=e+1,t>this.maxChunks)return!1;this.missingChunkNumbers.unshift(t)}return t}return!1}},{key:"removeChunkNumber",value:function(){if(this.missingChunkNumbers.length>0){var e=this.missingChunkNumbers[0];-1!==e&&this.missingChunkNumbers.splice(0,1)}}},{key:"maxChunks",get:function(){var e=1024*this.chunkSizeInMB*1024,t=this.file.size;return Math.ceil(t/e)}}]),e}(),ce=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;Object(l["a"])(this,e),this.chunkSizeInMB=t,this.event=new le["EventEmitter"],this.fileUploaders=[],this.upload=null,this.trials=0}return Object(o["a"])(e,[{key:"addFiles",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(t){var a,n,i,s,l=this;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,se["a"].getSecuredFilenames(t.map((function(e){return e.name})));case 2:a=e.sent,n=Object(ne["a"])(a);try{for(s=function(){var e=i.value,a=t.find((function(t){return t.name===e.original_name}));if(!a)throw new Error("File mapping error");var n=new ue(a,e.secured_name,l.chunkSizeInMB);n.onChunkComplete((function(){l.emitResume()})),l.fileUploaders.push(n)},n.s();!(i=n.n()).done;)s()}catch(r){n.e(r)}finally{n.f()}case 5:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"removeFile",value:function(e){var t=this.fileUploaders.findIndex((function(t){return t.fileName===e}));-1!==t&&this.fileUploaders.splice(t,1)}},{key:"onError",value:function(e){this.event.on(te.ERROR,e)}},{key:"onStartUpload",value:function(e){this.event.on(te.START_UPLOAD,e)}},{key:"onResume",value:function(e){this.event.on(te.RESUME_UPLOAD_AFTER_ERROR,e)}},{key:"onUploadComplete",value:function(e){this.event.on(te.UPLOAD_COMPLETE,e)}},{key:"onUploadCanceled",value:function(e){this.event.on(te.UPLOAD_CANCELED,e)}},{key:"getTrials",value:function(){return this.trials}},{key:"emitError",value:function(e){this.event.emit(te.ERROR,e),this.trials+=1}},{key:"emitResume",value:function(){this.trials=0,this.event.emit(te.RESUME_UPLOAD_AFTER_ERROR)}},{key:"emitCancel",value:function(){this.trials=0,this.event.emit(te.UPLOAD_CANCELED)}},{key:"getCreateUploadFiles",value:function(){return this.fileUploaders.map((function(e){return{name:e.fileName,size:e.file.size}}))}},{key:"prepareFileUploaders",value:function(){var e=this;if(!this.upload)throw new Error("Upload is undefined. Missing upload object");var t,a=Object(ne["a"])(this.fileUploaders);try{var n=function(){var a=t.value,n=e.upload.files.find((function(e){return e.name==a.fileName}));if(!n)throw new Error("File mapping error");a.uploadId=e.upload.upload_id,a.fileId=n.id,a.complete=n.complete,a.missingChunkNumbers=n.missing_chunks};for(a.s();!(t=a.n()).done;)n()}catch(i){a.e(i)}finally{a.f()}}},{key:"setUpload",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(t){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=6;break}return e.next=3,se["a"].getUpload(t);case 3:this.upload=e.sent,e.next=7;break;case 6:this.upload=t;case 7:this.prepareFileUploaders();case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"startUpload",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(){var t,a,n,i,s,l;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.upload){e.next=2;break}throw new Error("No upload created or resumed");case 2:if(0!==this.fileUploaders.length){e.next=4;break}throw new Error("No files to upload");case 4:if(!this.fileUploaders.find((function(e){return!e.fileId}))){e.next=6;break}throw new Error("Files not prepared for upload");case 6:if(t=this.getInvalidUploadFilesSelection(),!(t.missingFiles.length>0||t.unknownFiles.length>0)){e.next=9;break}throw new Error("Missing upload files or unknown upload files for resume upload");case 9:window.onbeforeunload=function(){return!0},this.event.emit(te.START_UPLOAD);case 11:if(void 0===(a=this.fileUploaders.find((function(e){return!e.complete})))){e.next=53;break}return e.prev=12,e.next=15,this.tryUpload(a);case 15:e.next=51;break;case 17:e.prev=17,e.t0=e["catch"](12),n=3;case 20:if(!(n>0)){e.next=35;break}return e.prev=21,e.next=24,this.tryUpload(a);case 24:return e.abrupt("break",35);case 27:return e.prev=27,e.t1=e["catch"](21),n--,i=1e3*Math.abs(n-3),e.next=33,Object(oe["b"])(i);case 33:e.next=20;break;case 35:s=!0;case 36:if(!s||!this.upload){e.next=51;break}return e.prev=37,e.next=40,this.refreshUpload();case 40:s=!1,e.next=49;break;case 43:return e.prev=43,e.t2=e["catch"](37),this.emitError(e.t2),l=this.trials<100?1e4:6e4,e.next=49,Object(oe["b"])(l);case 49:e.next=36;break;case 51:e.next=11;break;case 53:window.onbeforeunload=null;case 54:case"end":return e.stop()}}),e,this,[[12,17],[21,27],[37,43]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"cancelUpload",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return window.onbeforeunload=null,e.next=3,se["a"].cancelUpload(this.upload.upload_id);case 3:this.reset(),this.emitCancel();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getInvalidUploadFilesSelection",value:function(){var e=this;if(!this.upload)throw new Error("upload is undefined");var t={missingFiles:this.upload.files.filter((function(t){return!e.fileUploaders.find((function(e){return e.fileName===t.name}))})).map((function(e){return e.name})),unknownFiles:this.fileUploaders.filter((function(t){return!e.upload.files.find((function(e){return e.name===t.fileName}))})).map((function(e){return e.fileName}))};return t}},{key:"tryUpload",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(t){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.upload();case 3:this.isUploadComplete()&&(this.event.emit(te.UPLOAD_COMPLETE),this.reset()),e.next=11;break;case 6:throw e.prev=6,e.t0=e["catch"](0),t.emitError(),this.emitError(e.t0),e.t0;case 11:case"end":return e.stop()}}),e,this,[[0,6]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"refreshUpload",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.upload){e.next=2;break}throw new Error("Upload is undefined");case 2:return e.next=4,this.setUpload(this.upload.upload_id);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"isUploadComplete",value:function(){return!this.fileUploaders.find((function(e){return!e.complete}))}},{key:"reset",value:function(){this.upload=null;var e,t=Object(ne["a"])(this.fileUploaders);try{for(t.s();!(e=t.n()).done;){var a=e.value;a.unregisterEvents()}}catch(n){t.e(n)}finally{t.f()}this.fileUploaders=[]}}]),e}(),pe=a(119),de=a(301),fe=a(303),he=function(e){Object(u["a"])(a,e);var t=Object(c["a"])(a);function a(e,n,i){var r;return Object(l["a"])(this,a),r=t.call(this,i),r.plantId=e,r.analysisId=n,r.flownAt=void 0,r.orderProductPackageIds=void 0,r}return Object(o["a"])(a,[{key:"addFiles",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(t){var n,i,s,l,o,u,c,p,d;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(ie["a"])(Object(re["a"])(a.prototype),"addFiles",this).call(this,t);case 2:if(this.analysisId){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,se["a"].getAnalysis(this.analysisId);case 6:if(n=e.sent,!n.files){e.next=15;break}for(i=[],s=0,l=Object.keys(n.files);s<l.length;s++)o=l[s],i=i.concat(n.files[o]);return e.next=12,se["a"].getAnalysisFiles(n.id,i);case 12:u=e.sent,c=Object(ne["a"])(this.fileUploaders);try{for(c.s();!(p=c.n()).done;)d=p.value,u[d.fileName]&&(d.description=pe["i18n"].t("file-exists-and-overide").toString())}catch(r){c.e(r)}finally{c.f()}case 15:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"doUpload",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.analysisId){e.next=5;break}if(this.flownAt){e.next=3;break}throw{error:"INVALID_OR_MISSING_PARAMS",message:pe["i18n"].t("missing").toString()+" "+pe["i18n"].t("acquisition-date").toString()};case 3:if(this.plantId){e.next=5;break}throw{error:"INVALID_OR_MISSING_PARAMS",message:pe["i18n"].t("missing").toString()+" "+pe["i18n"].t("plant").toString()};case 5:return e.next=7,this.createAnalysisUpload();case 7:return this.analysisId&&de["a"].emit(this.analysisId,fe["a"].UPDATE_ANALYSIS),e.prev=8,e.next=11,this.startUpload();case 11:return e.prev=11,this.analysisId&&de["a"].emit(this.analysisId,fe["a"].UPDATE_ANALYSIS),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[8,,11,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"setFlownAt",value:function(e){this.flownAt=e}},{key:"setAnalysisId",value:function(e){this.analysisId=e}},{key:"setPlantId",value:function(e){this.plantId=e}},{key:"setOrderProductPackageIds",value:function(e){this.orderProductPackageIds=e}},{key:"createAnalysisUpload",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(){var t;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.upload){e.next=7;break}return e.next=3,se["a"].createAnalysisUpload({chunk_size_in_mb:this.chunkSizeInMB,files:this.getCreateUploadFiles(),analysis_id:this.analysisId,create_analysis:!this.analysisId&&{flown_at:this.flownAt,plant_id:this.plantId,order_product_package_ids:this.orderProductPackageIds}||void 0});case 3:return t=e.sent,this.analysisId||(this.analysisId=t.analysis_id),e.next=7,this.setUpload(t);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),a}(ce),ve=a(299),be=function(e,t,a,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if("object"===("undefined"===typeof Reflect?"undefined":Object(p["a"])(Reflect))&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,a,n);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(s=(r<3?i(s):r>3?i(t,a,s):i(t,a))||s);return r>3&&s&&Object.defineProperty(t,a,s),s},ye=function(e){Object(u["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(l["a"])(this,a),e=t.apply(this,arguments),e.dataComplete=!1,e.hasPlantMetadata=!1,e.uploaderService=null,e.gotoNewAnalysis=null,e.appContentEventId="newAnalysis",e}return Object(o["a"])(a,[{key:"created",value:function(){var e;this.uploaderService=new he(this.plantId||void 0,null===(e=this.analysis)||void 0===e?void 0:e.id),this.dataComplete=!!this.analysis&&this.analysis.data_complete,this.hasPlantMetadata=this.analysis&&this.analysis.has_plant_metadata||!1,this.analysis&&(this.appContentEventId=this.analysis.id),this.registerUploadEvents()}},{key:"onAnalysisChanged",value:function(){this.dataComplete=!!this.analysis&&this.analysis.data_complete,this.hasPlantMetadata=this.analysis&&this.analysis.has_plant_metadata||!1}},{key:"onPlantIdChanged",value:function(){this.plantId&&this.uploaderService.setPlantId(this.plantId)}},{key:"onFlownAtChanged",value:function(){this.flownAt&&this.uploaderService.setFlownAt(this.flownAt)}},{key:"onOrderProductPackageIdsChanged",value:function(){this.orderProductPackageIds&&this.uploaderService.setOrderProductPackageIds(this.orderProductPackageIds)}},{key:"registerUploadEvents",value:function(){var e=this;this.uploaderService.onStartUpload(Object(s["a"])(Object(r["a"])().mark((function t(){var a;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.t0=e.analysis,t.t0){t.next=5;break}return t.next=4,se["a"].getAnalysis(e.uploaderService.analysisId);case 4:t.t0=t.sent;case 5:a=t.t0,e.hasPlantMetadata=a.has_plant_metadata||!1;case 7:case"end":return t.stop()}}),t)})))),this.uploaderService.onUploadComplete(Object(s["a"])(Object(r["a"])().mark((function t(){var a;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,se["a"].getAnalysis(e.uploaderService.analysisId);case 2:a=t.sent,a.has_plant_metadata&&a.data_complete&&f["a"].showInfo(e.appContentEventId,e.$t("analysis-with-metdata-data-complete_quest").toString()),e.hasPlantMetadata=a.has_plant_metadata||!1,e.analysis||(e.gotoNewAnalysis=a);case 6:case"end":return t.stop()}}),t)})))),this.uploaderService.onUploadCanceled(Object(s["a"])(Object(r["a"])().mark((function t(){return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.analysis){t.next=4;break}return t.next=3,se["a"].getAnalysis(e.uploaderService.analysisId);case 3:e.gotoNewAnalysis=t.sent;case 4:case"end":return t.stop()}}),t)}))))}},{key:"allowUploadFurtherData",get:function(){return!(this.dataComplete&&this.analysis)}},{key:"dataCompleteVerified",get:function(){return!!(this.analysis&&this.analysis.current_state.state.id>=ve["a"].DATA_COMPLETE_VERIFIED)}},{key:"analysisIsEmpty",get:function(){var e;return!(!this.analysis||(null===(e=this.analysis.current_state)||void 0===e?void 0:e.state.id)!=ve["a"].EMPTY)}},{key:"analysisHasAvailableDrones",get:function(){return null!=this.droneOptions&&this.droneOptions.length>0}},{key:"analysisHasSelectedDrone",get:function(){return null!=this.selectedDrone&&null!=this.selectedDrone.id}},{key:"onChangeDataComplete",value:function(){var e=Object(s["a"])(Object(r["a"])().mark((function e(){var t;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,se["a"].getAnalysis(this.uploaderService.analysisId);case 2:if(t=e.sent,t.plant.in_setup_phase||!this.dataComplete){e.next=7;break}if(confirm(this.$t("data-complete-sure-quest").toString())){e.next=7;break}return this.dataComplete=!1,e.abrupt("return");case 7:return e.next=9,se["a"].updateAnalysis(t.id,{data_complete:this.dataComplete});case 9:de["a"].emit(t.id,fe["a"].UPDATE_ANALYSIS);case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onGotoNewAnalysisClick",value:function(){this.$router.push({name:"EditAnalysis",params:{id:this.gotoNewAnalysis.id}})}}]),a}(J["a"]);be([Object(m["b"])({default:null})],ye.prototype,"plantId",void 0),be([Object(m["b"])({default:null})],ye.prototype,"flownAt",void 0),be([Object(m["b"])({default:null})],ye.prototype,"analysis",void 0),be([Object(m["b"])({default:null})],ye.prototype,"orderProductPackageIds",void 0),be([Object(m["b"])({default:null})],ye.prototype,"selectedDrone",void 0),be([Object(m["b"])({default:null})],ye.prototype,"droneOptions",void 0),be([Object(m["d"])("analysis")],ye.prototype,"onAnalysisChanged",null),be([Object(m["d"])("plantId")],ye.prototype,"onPlantIdChanged",null),be([Object(m["d"])("flownAt")],ye.prototype,"onFlownAtChanged",null),be([Object(m["d"])("orderProductPackageIds")],ye.prototype,"onOrderProductPackageIdsChanged",null),be([Object(K["a"])()],ye.prototype,"onChangeDataComplete",null),be([Object(K["a"])()],ye.prototype,"onGotoNewAnalysisClick",null),ye=be([Object(m["a"])({name:"app-analysis-uploader",components:{AppContent:h["a"],AppUploader:ae,AppButton:d["a"],AppExplanation:v["a"]}})],ye);var me=ye,Oe=me,ge=Object(S["a"])(Oe,n,i,!1,null,null,null);ge.options.__file="src/app/analysis/shared/analysis-uploader.vue";t["a"]=ge.exports},473:function(e,t,a){"use strict";a(363)},474:function(e,t,a){"use strict";a(364)},475:function(e,t,a){"use strict";a(365)}}]);